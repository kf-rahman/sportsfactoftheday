{% extends "base.html" %}
{% block content %}
  <div class="mt-10 bg-white shadow-sm rounded-xl p-6 space-y-4">
    <h1 class="text-2xl font-semibold">Sports Facts</h1>

    <label for="sport" class="block text-sm font-medium">Choose a sport</label>
    <select id="sport" class="w-full border rounded-lg p-2">
      <option value="nba">NBA</option>
      <option value="mlb">MLB</option>
      <option value="nhl">NHL</option>
    </select>

    <button id="generateBtn" class="w-full mt-2 rounded-lg p-3 bg-black text-white">
      Generate Fact
    </button>

    <div id="factBox" class="min-h-[3rem] rounded-lg bg-gray-100 p-3 text-sm">
      <!-- fact will appear here -->
      <span class="text-gray-500">Click “Generate Fact” to see one.</span>
    </div>

    <hr class="my-4" />

    <form id="signupForm" class="space-y-2">
      <label class="block text-sm font-medium">Join the mailing list</label>
      <input id="email" type="email" placeholder="you@example.com"
             class="w-full border rounded-lg p-2" required />

      <div class="flex items-center gap-3 text-sm">
        <label class="flex items-center gap-2">
          <input type="checkbox" value="nba" checked /> NBA
        </label>
        <label class="flex items-center gap-2">
          <input type="checkbox" value="mlb" /> MLB
        </label>
        <label class="flex items-center gap-2">
          <input type="checkbox" value="nhl" /> NHL
        </label>
      </div>

      <button class="w-full rounded-lg p-3 bg-gray-900 text-white">
        Sign Up
      </button>
    </form>
  </div>

  <script>
  async function generateFact() {
    const box = document.getElementById('factBox');
    box.textContent = "Fetching MLB data…";
    try {
      const res = await fetch(`/api/generate?debug=1`); // debug=1 while developing
      const text = await res.text();
      let data; try { data = JSON.parse(text); } catch { data = {}; }

      if (!res.ok) throw new Error((data && data.detail) || `HTTP ${res.status}`);

      box.textContent = data.text || "No data returned.";
      if (data.fields) console.log("MLB fields:", data.fields);
    } catch (err) {
      box.textContent = err.message || "Could not fetch MLB data right now.";
      console.error(err);
    }
  }

  document.getElementById('generateBtn').addEventListener('click', generateFact);

  // signup handler stays the same
</script>


{% endblock %}
